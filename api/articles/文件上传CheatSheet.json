{"title":"文件上传CheatSheet","slug":"文件上传CheatSheet","date":"2020-02-22T12:38:45.334Z","updated":"2020-02-22T12:38:27.122Z","comments":true,"path":"api/articles/文件上传CheatSheet.json","photos":[],"link":"","excerpt":"1.禁用js2.修改Content-Type3.黑名单绕过-上传特殊文件","covers":null,"content":"<h5 id=\"1-禁用js\"><a href=\"#1-禁用js\" class=\"headerlink\" title=\"1.禁用js\"></a>1.禁用js</h5><h5 id=\"2-修改Content-Type\"><a href=\"#2-修改Content-Type\" class=\"headerlink\" title=\"2.修改Content-Type\"></a>2.修改Content-Type</h5><h5 id=\"3-黑名单绕过-上传特殊文件\"><a href=\"#3-黑名单绕过-上传特殊文件\" class=\"headerlink\" title=\"3.黑名单绕过-上传特殊文件\"></a>3.黑名单绕过-上传特殊文件<a id=\"more\"></a></h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html、htm、swf、php5、.htaccess、web.config、web.xml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-上传-htaccess\"><a href=\"#4-上传-htaccess\" class=\"headerlink\" title=\"4.上传.htaccess\"></a>4.上传.htaccess</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;a.匹配文件名解析</span><br><span class=\"line\">&lt;FilesMatch &quot;123456.jpg&quot;&gt;</span><br><span class=\"line\">  SetHandler application&#x2F;x-httpd-php</span><br><span class=\"line\">&lt;&#x2F;FilesMatch&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;b.匹配文件类型</span><br><span class=\"line\">AddType application&#x2F;x-httpd-php .jpg</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-更改后缀大小写\"><a href=\"#5-更改后缀大小写\" class=\"headerlink\" title=\"5.更改后缀大小写\"></a>5.更改后缀大小写</h5><h5 id=\"6-后缀加-空格-DATA-等\"><a href=\"#6-后缀加-空格-DATA-等\" class=\"headerlink\" title=\"6.后缀加    空格    .    ::$DATA     等\"></a>6.后缀加    空格    .    ::$DATA     等</h5><h5 id=\"7-利用解析漏洞\"><a href=\"#7-利用解析漏洞\" class=\"headerlink\" title=\"7.利用解析漏洞\"></a>7.利用解析漏洞</h5><h5 id=\"8-后缀去除缺陷\"><a href=\"#8-后缀去除缺陷\" class=\"headerlink\" title=\"8.后缀去除缺陷\"></a>8.后缀去除缺陷</h5><p>​    只去除一次黑名单字符：组合 点空格点 、双写绕过xxx.pphphp等</p>\n<h5 id=\"9-00截断\"><a href=\"#9-00截断\" class=\"headerlink\" title=\"9.%00截断\"></a>9.%00截断</h5><p>​    修改上传目录参数为upload/test.php%00 文件名为合法文件后缀 保存时产生截断</p>\n<h5 id=\"10-上传一般图片马\"><a href=\"#10-上传一般图片马\" class=\"headerlink\" title=\"10.上传一般图片马\"></a>10.上传一般图片马</h5><p>​    copy /b a.jpg + /b phpinfo.php phpinfo.jpg  或者利用十六进制编辑器wxMEdit编辑添加</p>\n<h5 id=\"11-条件竞争\"><a href=\"#11-条件竞争\" class=\"headerlink\" title=\"11.条件竞争\"></a>11.条件竞争</h5><p>​    若服务器会先保存文件再判断文件合法性，可一直上传文件并不断访问，达到程序执行判断逻辑前就访问到图片的目的。</p>\n<h5 id=\"12-绕过二次渲染\"><a href=\"#12-绕过二次渲染\" class=\"headerlink\" title=\"12.绕过二次渲染\"></a>12.绕过二次渲染</h5><p>​    gif WinMerge对比上传前后文件的差别  编辑渲染后没有变化的片段</p>\n<p>​    jpg 利用jpg_payload.php转换</p>\n<h5 id=\"13-日志包含\"><a href=\"#13-日志包含\" class=\"headerlink\" title=\"13.日志包含\"></a>13.日志包含</h5><p>​    如：某个PHP文件存在本地包含漏洞，但是无法上传文件时，可通过包含apache日志文件获取shell。</p>\n","categories":[],"tags":[]}